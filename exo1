--@copyright_AYOUB_GHOUDAN_BARI
--Création de la base de données et contraintes d’intégrité.

--1
CREATE TABLE DEPT(
    DEPTNO number(20),
    DNAME varchar2(20),
    LOC varchar2(20),
    CONSTRAINT deptno_pk PRIMARY KEY(DEPTNO),
    CONSTRAINT deptno_ck CHECK (DNAME IN('ACCOUNTING','RESEARCH','SALES','OPERATIONS'))
);
--2
INSERT INTO DEPT VALUES(10,'ACCOUNTING','NEW_YORK');
INSERT INTO DEPT VALUES(20,'RESEARCH','DALLAS');
INSERT INTO DEPT VALUES(30,'SALES','CHICAGO');
INSERT INTO DEPT VALUES(40,'OPERATIONS','BOSTON');
--3
CREATE TABLE EMP AS SELECT * FROM SCOTT.EMP;
--4
INSERT INTO EMP VALUES(7369,'Bidon',NULL,NULL,NULL,NULL,NULL,NULL);
-- L'insertion fonctionne car on a pas encore ajouter la cle primaire.
--5
ROLLBACK; /*or*/ DELETE FROM EMP WHERE EMPNO=7369 AND ENAME='Bidon';
--6
ALTER TABLE EMP
ADD (CONSTRAINT emp_empno_pk PRIMARY KEY(EMPNO),
     CONSTRAINT emp_empno_FK FOREIGN KEY(DEPTNO) REFERENCES DEPT(DEPTNO));
--7
INSERT INTO EMP VALUES (7369, 'WILSON', 'MANAGER', 7839, '17/11/91', 3500.00, 600.00, 10),
                       (7657, 'WILSON','MANAGER', 7839, '17/11/91', 3500.00, 600.00, 50),
                       (7657, 'WILSON', 'MANAGER', 7000,'17/11/91', 3500.00, 600.00, 10),
                       (7657, 'WILSON', 'MANAGER', 7839, '17/11/91', 3500.00,600.00, 10);
--8
COMMIT; 

--Mise a jour de la base de données

--1
UPDATE DEPT SET LOC='PITTSBURGH'
WHERE DNAME='SALES';
--2
UPDATE EMP SET SAL=SAL+SAL*10/100
WHERE COMM>SAL*50/100;
--3
UPDATE EMP SET COMM=AVG(nvl(COMM,0))
WHERE COMM is NULL AND HIREDATE< TO_DATE('01/01/82','dd/mm/RR');
--4
ROLLBACK;
--5
DELETE FROM DEPT
WHERE DEPTNO=20;
/*On ne peut pas le supprimer parceque deptno est une cle etrangere dans la table emp et existe des employes du departement n°20 dans cette derniere.*/

--Interrogation de la base de données

--1
SELECT ENAME,SAL,COMM,SAL+COMM 
FROM EMP
WHERE JOB ='SALESMAN';
--2
SELECT ENAME
FROM EMP
GROUP BY ENAME
ORDER BY AVG(COMM/SAL) DESC;
--3
SELECT ENAME
FROM EMP
WHERE COMM < sal*25/100;
--4
SELECT COUNT(EMPNO)
FROM EMP
WHERE DEPTNO=10;
--5
SELECT COUNT(EMPNO)
FROM EMP
WHERE COMM IS NOT NULL;
--6
SELECT COUNT(DISTINCT JOB)
FROM EMP;
--7
SELECT AVG(SAL)
FROM EMP
ORDER BY JOB;
--8
SELECT SUM(e.SAL)
FROM EMP e, DEPT d
WHERE e.DEPTNO=D.DEPTNO
AND D.DNAME='SALES';
--9
SELECT e.ENAME, d.DNAME
FROM EMP e, DEPT d
WHERE e.DEPTNO=D.DEPTNO.
--10
SELECT ENAME,JOB,SAL
FROM EMP
GROUP BY ENAME,JOB,SAL
HAVING SAL=MAX(SAL);
--11
SELECT ENAME 
FROM EMP
WHERE SAL> ALL(SELECT SAL
            FROM EMP
            WHERE ENAME='JONES');
--12
SELECT ENAME 
FROM EMP
WHERE JOB= ALL(SELECT JOB
            FROM EMP
            WHERE ENAME='JONES');
--13
SELECT ENAME 
FROM EMP
WHERE MGR= ALL(SELECT MGR
            FROM EMP
            WHERE ENAME='CLARK');
--14
SELECT ENAME,JOB
FROM EMP
WHERE MGR=ALL(SELECT MGR
            FROM EMP
            WHERE ENAME='TURNER')
AND JOB=ALL(SELECT JOB
            FROM EMP
            WHERE ENAME='TURNER');
--15
SELECT ENAME
FROM EMP
WHERE HIREDATE < ALL(SELECT HIREDATE
                  FROM EMP
                  WHERE DEPTNO=10);
--16
SELECT E.ENAME, M.ENAME
FROM EMP E, EMP M
WHERE E.EMPNO=M.EMPNO;
--17
SELECT E.ENAME
FROM EMP E, EMP M
WHERE E.EMPNO=M.EMPNO
AND E.DEPTNO <> M.DEPTNO;




